<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" type="text/css" href="./public/index.css">
  <title>CrimeX</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
  <script>
    $(document).ready(function() {
      for (var content of ['about', 'team', 'event']) {
        (function(content) {
          $('#btn-' + content).on('click', function(event) {
            event.preventDefault();
            $('#light-box-' + content).fadeIn();
          });
        })(content)
      }

      $('.light-box-close-btn').on('click', function(event) {
        $('.light-box').fadeOut()
      })
    });
  </script>
</head>
<body>
  <input type="checkbox" name="trigger-btn" id="trigger-btn">
  <div id="wrapper">
    <nav>
      <div id="logo">
        <img src="./public/img/logo_white.png" alt="crimeX-white-logo">
      </div>
    </nav>

    <div id="map"></div>
    <div id="filter-app"></div>

    <div id="btn-group">
      <button><label for="trigger-btn">X
        <span id="first"></span>
        <span id="second"></span>
        <span id="third"></span>
      </label></button>
      <button id="btn-about"><img src="./public/img/about.png" alt="crimeX-about"></button>
      <button id="btn-team"><img src="./public/img/team.png" alt="crimeX-team"></button>
      <button id="btn-event"><img src="./public/img/event.png" alt="crimeX-event"></button>
    </div>
  </div>

  <div id="light-box-about" class="light-box">
    <div class="light-box-wrapper">
      <button class="light-box-close-btn">
        <span></span><span></span>
      </button>
      <div class="light-box-content">
        <div class="light-box-header">
          <h2>關於 CrimeX 犯罪地圖</h2>
        </div>
        <div class="light-box-body" id="crime-x-logo">
          <img src="./public/img/logo.png" alt="crimeX logo" />
        </div>
        <div class="light-box-body" id="crime-x-article">
          <p style="color: yellow; font-size: 200%">6秒鐘找完16萬筆？Crime X 做得到！</p></br>

          我們將政府公開的各式文件，經分析後建成資料庫，並直接視覺化，讓一般民眾也能輕鬆查詢任何想要的資料。</br></br>

          <p style="background-color: rgba(0,0,0,0.3); margin-left: -20pt; margin-right: -20pt; padding: 10pt;">應用層面</p></br>
          找屋、路線規劃、安全防護...等等。</br></br>

          
          <p style="background-color: rgba(0,0,0,0.3); margin-left: -20pt; margin-right: -20pt; padding: 10pt;">未來展望</p></br>
          加入更多類別，例如：災情案件資料、警廣即時案件通報等等，將無排序之大量資料轉化為易於分析之圖表，做出更精準、複雜的預測與資料推演
        </div>
        <div style="margin-top: 50pt"></div>
      </div>
    </div>
  </div>

  <div id="light-box-team" class="light-box">
    <div class="light-box-wrapper">
      <button class="light-box-close-btn">
        <span></span><span></span>
      </button>
      <div class="light-box-content">
        <div class="light-box-header">
          <h2>CrimeX 製作團隊</h2>
        </div>
        <div class="light-box-body">
          <div class="team-member-panel">
            <img src="./public/img/team.png" alt="Avatar" />
            <div>
              <p>劉立宏</p>
              <p>資料分析工程師</p>
            </div>
          </div>
          
          後端工程師<br/>
          王仁顥<br/>

          REST API 工程師<br/>
          劉少雲<br/>

          前端工程師<br/>
          黃俊鑫<br/>

          UI/UX 設計師<br/>
          陳怡榕<br/>
        </div>
      </div>
    </div>
  </div>

  <div id="light-box-event" class="light-box">
    <div class="light-box-wrapper">
      <button class="light-box-close-btn">
        <span></span><span></span>
      </button>
      <div class="light-box-content">
        <div class="light-box-header">
          <h2>HackNTU 2017</h2>
        </div>
        <div class="light-box-body">
        本系統使用之資料取自於內政部之內政資料開放平臺，<br/>
        並使用ARCgis(geocode.arcgis.com)公開服務將地址轉換成經緯度顯示於地圖上<br/>
        鑒於部分資料僅標示路段或行政區域，故，所有位置僅供參考<br/>
        詳細資料，可藉由本站提供之API查詢<br/>
        </div>
      </div>
    </div>
  </div>

  <!-- Google Map -->
  <script>
    var map;
    var styles = [
      {
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#f5f5f5"
          }
        ]
      },
      {
        "elementType": "labels.icon",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#616161"
          }
        ]
      },
      {
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#f5f5f5"
          }
        ]
      },
      {
        "featureType": "administrative.country",
        "elementType": "labels.text",
        "stylers": [
          {
            "weight": 7
          }
        ]
      },
      {
        "featureType": "administrative.land_parcel",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f4818c"//"#8a8a8d"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#eeeeee"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f699a2"//"#757575"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#e5e5e5"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f26a77"//"#9e9e9e"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#ffa6a6"//"#ffffff"
          }
        ]
      },
      {
        "featureType": "road.arterial",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f699a2"//"#757575"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#dadada"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f8b0b7"//"#616161"
          },
          {
            "weight": 6.5
          }
        ]
      },
      {
        "featureType": "road.local",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f26a77"//"#9e9e9e"
          }
        ]
      },
      {
        "featureType": "transit.line",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#e5e5e5"
          }
        ]
      },
      {
        "featureType": "transit.station",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#eeeeee"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#ffe8ee"//"#c9c9c9"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#f26a77"//"#9e9e9e"
          }
        ]
      }
    ];
    var current_bound;
    var $markers = []
    var $heatmap = null

    function initMap() {google.maps.__gjsload__('visualization', function(_){var lx=function(a){return _.mb(a)&&null!=a?a instanceof _.F?!0:a.location instanceof _.F&&(!a.weight||_.y(a.weight)):!1},mx=_.oa(),nx=function(a){this.set("data",new _.td);this.setValues(a)},ox=function(a){this.setValues(a)},px=function(a){this.setValues(a)};_.t(mx,_.D);_.t(nx,mx);nx.prototype.setData=function(a){if(!(_.Ja(a)||a instanceof _.td))throw _.oc("not an Array or MVCArray");_.m(a.getLength)||(a=new _.td(a));_.vc(lx)(a.getArray());this.set("data",a)};nx.prototype.map_changed=function(){var a=this;_.G("visualization_impl",function(b){b.b(a)})};_.rd(nx.prototype,{map:_.pi,data:null});_.t(ox,_.D);_.rd(ox.prototype,{layerId:_.Nh,layerKey:_.Nh,map:_.pi,mapId:_.Nh,opacity:_.Mh,properties:null,status:null});_.t(px,_.D);_.rd(px.prototype,{layerId:_.Nh,layerKey:_.Nh,map:_.pi,mapId:_.Nh,opacity:_.Mh,properties:null,status:null,zIndex:_.Mh});_.Vb.google.maps.visualization={DynamicMapsEngineLayer:ox,HeatmapLayer:nx,MapsEngineLayer:px,MapsEngineStatus:{OK:_.ia,INVALID_LAYER:"INVALID_LAYER",UNKNOWN_ERROR:_.la}};_.Xc("visualization",{});});
      var taipei = {lat: 25.0238415, lng: 121.5310981};
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 13,
        center: taipei,
        disableDefaultUI: true,
        styles: styles,
      });
      current_bound = map.getBounds();

      var updateBound = function() {
        b = map.getBounds();
        current_bound = {
          left: b.b.b,
          right: b.b.f,
          top: b.f.f,
          bottom: b.f.b
        }
      }
      map.addListener('bounds_changed', updateBound);
      map.addListener('center_changed', updateBound);
    }

    function clearMarkers() {
      for (var i = 0; i < $markers.length; i++ ) {
        $markers[i].setMap(null);
      }
      $markers.length = 0;
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOdF09pHdFT2gsp6mevR2dDHyDJux_Oao&libraries=visual‌​ization&callback=initMap"></script>
  <script type="text/babel">
    var cityLocation = {
      "臺北市": { lat: 25.037370000000067, lng: 121.56355000000008 },
      "高雄市": { lat: 22.62014000000005, lng: 120.31226000000004 },
      "屏東縣": { lat: 22.683440000000076, lng: 120.48579000000007 },
      "雲林縣": { lat: 23.69963000000007, lng: 120.52627000000007 },
      "南投縣": { lat: 23.90283000000005, lng: 120.69112000000007 },
      "臺南市": { lat: 22.99124000000006, lng: 120.18474000000003 },
      "新北市": { lat: 25.011930000000064, lng: 121.46562000000006 },
      "花蓮縣": { lat: 23.99129000000005, lng: 121.62056000000007 },
      "臺中市": { lat: 24.163820000000044, lng: 120.64718000000005 },
      "新竹市": { lat: 24.806190000000072, lng: 120.96893000000011 },
      "基隆市": { lat: 25.131620000000055, lng: 121.74479000000008 },
      "新竹縣": { lat: 24.826690000000042, lng: 121.01281000000006 },
      "苗栗縣": { lat: 24.56353000000007, lng: 120.82055000000003 },
      "宜蘭縣": { lat: 24.731490000000065, lng: 121.76306000000011 },
      "桃園市": { lat: 24.993630000000053, lng: 121.3009800000001 },
      "嘉義市": { lat: 23.48151000000007, lng: 120.4535800000001 },
      "彰化縣": { lat: 24.076020000000028, lng: 120.54411000000005 },
      "金門縣": { lat: 24.436860000000024, lng: 118.31848000000002 },
      "澎湖縣": { lat: 23.56964000000005, lng: 119.5661100000001 },
      "嘉義縣": { lat: 23.459220000000073, lng: 120.29307000000006 },
      "臺東縣": { lat: 22.755210000000034, lng: 121.15052000000003 },
      "連江縣": { lat: 26.157670000000053, lng: 119.95158000000004 },
    };
    var cityEncodings = {
      "臺北市": {
        "citycode": "1",
        "中正區": "100",
        "大同區": "103",
        "中山區": "104",
        "松山區": "105",
        "大安區": "106",
        "萬華區": "108",
        "信義區": "110",
        "士林區": "111",
        "北投區": "112",
        "內湖區": "114",
        "南港區": "115",
        "文山區": "116"
      },
      "新北市": {
        "citycode": "3",
        "萬里區": "207",
        "金山區": "208",
        "板橋區": "220",
        "汐止區": "221",
        "深坑區": "222",
        "石碇區": "223",
        "瑞芳區": "224",
        "平溪區": "226",
        "雙溪區": "227",
        "貢寮區": "228",
        "新店區": "231",
        "坪林區": "232",
        "烏來區": "233",
        "永和區": "234",
        "中和區": "235",
        "土城區": "236",
        "三峽區": "237",
        "樹林區": "238",
        "鶯歌區": "239",
        "三重區": "241",
        "新莊區": "242",
        "泰山區": "243",
        "林口區": "244",
        "蘆洲區": "247",
        "五股區": "248",
        "八里區": "249",
        "淡水區": "251",
        "三芝區": "252",
        "石門區": "253"
      },
      "基隆市": {
        "citycode": "2",
        "仁愛區": "200",
        "信義區": "201",
        "中正區": "202",
        "中山區": "203",
        "安樂區": "204",
        "暖暖區": "205",
        "七堵區": "206"
      },
      "宜蘭縣": {
        "citycode": "21",
        "宜蘭市": "260",
        "頭城鎮": "261",
        "礁溪鄉": "262",
        "壯圍鄉": "263",
        "員山鄉": "264",
        "羅東鎮": "265",
        "三星鄉": "266",
        "大同鄉": "267",
        "五結鄉": "268",
        "冬山鄉": "269",
        "蘇澳鎮": "270",
        "南澳鄉": "272",
        "釣魚台列嶼": "290"
      },
      "新竹市": {
        "citycode": "4",
        "東區、北區以及香山區": "300"
      },
      "新竹縣": {
        "citycode": "5",
        "竹北市": "302",
        "湖口鄉": "303",
        "新豐鄉": "304",
        "新埔鎮": "305",
        "關西鎮": "306",
        "芎林鄉": "307",
        "寶山鄉": "308",
        "竹東鎮": "310",
        "五峰鄉": "311",
        "橫山鄉": "312",
        "尖石鄉": "313",
        "北埔鄉": "314",
        "峨嵋鄉": "315"
      },
      "桃園市": {
        "citycode": "6",
        "中壢區": "320",
        "平鎮區": "324",
        "龍潭區": "325",
        "楊梅區": "326",
        "新屋區": "327",
        "觀音區": "328",
        "桃園區": "330",
        "龜山區": "333",
        "八德區": "334",
        "大溪區": "335",
        "復興區": "336",
        "大園區": "337",
        "蘆竹區": "338"
      },
      "苗栗縣": {
        "citycode": "7",
        "竹南鎮": "350",
        "頭份市": "351",
        "三灣鄉": "352",
        "南庄鄉": "353",
        "獅潭鄉": "354",
        "後龍鎮": "356",
        "通霄鎮": "357",
        "苑裡鎮": "358",
        "苗栗市": "360",
        "造橋鄉": "361",
        "頭屋鄉": "362",
        "公館鄉": "363",
        "大湖鄉": "364",
        "泰安鄉": "365",
        "銅鑼鄉": "366",
        "三義鄉": "367",
        "西湖鄉": "368",
        "卓蘭鎮": "369"
      },
      "臺中市": {
        "citycode": "8",
        "中區": "400",
        "東區": "401",
        "南區": "402",
        "西區": "403",
        "北區": "404",
        "北屯區": "406",
        "西屯區": "407",
        "南屯區": "408",
        "太平區": "411",
        "大里區": "412",
        "霧峰區": "413",
        "烏日區": "414",
        "豐原區": "420",
        "后里區": "421",
        "石岡區": "422",
        "東勢區": "423",
        "和平區": "424",
        "新社區": "426",
        "潭子區": "427",
        "大雅區": "428",
        "神岡區": "429",
        "大肚區": "432",
        "沙鹿區": "433",
        "龍井區": "434",
        "梧棲區": "435",
        "清水區": "436",
        "大甲區": "437",
        "外埔區": "438",
        "大安區": "439"
      },
      "彰化縣": {
        "citycode": "10",
        "彰化市": "500",
        "芬園鄉": "502",
        "花壇鄉": "503",
        "秀水鄉": "504",
        "鹿港鎮": "505",
        "福興鄉": "506",
        "線西鄉": "507",
        "和美鎮": "508",
        "伸港鄉": "509",
        "員林市": "510",
        "社頭鄉": "511",
        "永靖鄉": "512",
        "埔心鄉": "513",
        "溪湖鎮": "514",
        "大村鄉": "515",
        "埔鹽鄉": "516",
        "田中鎮": "520",
        "北斗鎮": "521",
        "田尾鄉": "522",
        "埤頭鄉": "523",
        "溪州鄉": "524",
        "竹塘鄉": "525",
        "二林鎮": "526",
        "大城鄉": "527",
        "芳苑鄉": "528",
        "二水鄉": "530"
      },
      "南投縣": {
        "citycode": "11",
        "南投市": "540",
        "中寮鄉": "541",
        "草屯鎮": "542",
        "國姓鄉": "544",
        "埔里鎮": "545",
        "仁愛鄉": "546",
        "名間鄉": "551",
        "集集鎮": "552",
        "水里鄉": "553",
        "魚池鄉": "555",
        "信義鄉": "556",
        "竹山鎮": "557",
        "鹿谷鄉": "558"
      },
      "雲林縣": {
        "citycode": "14",
        "斗南鎮": "630",
        "大埤鄉": "631",
        "虎尾鎮": "632",
        "土庫鎮": "633",
        "褒忠鄉": "634",
        "東勢鄉": "635",
        "臺西鄉以及台西鄉": "636",
        "崙背鄉": "637",
        "麥寮鄉": "638",
        "斗六市": "640",
        "林內鄉": "643",
        "古坑鄉": "646",
        "莿桐鄉": "647",
        "西螺鎮": "648",
        "二崙鄉": "649",
        "北港鎮": "651",
        "水林鄉": "652",
        "口湖鄉": "653",
        "四湖鄉": "654",
        "元長鄉": "655"
      },
      "嘉義市": {
        "citycode": "12",
        "東區以及西區": "600",
      },
      "嘉義縣": {
        "citycode": "13",
        "番路鄉": "602",
        "梅山鄉": "603",
        "竹崎鄉": "604",
        "阿里山": "605",
        "中埔鄉": "606",
        "大埔鄉": "607",
        "水上鄉": "608",
        "鹿草鄉": "611",
        "太保市": "612",
        "朴子市": "613",
        "東石鄉": "614",
        "六腳鄉": "615",
        "新港鄉": "616",
        "民雄鄉": "621",
        "大林鎮": "622",
        "溪口鄉": "623",
        "義竹鄉": "624",
        "布袋鎮": "625"
      },
      "臺南市": {
        "citycode": "15",
        "中西區": "700",
        "東區": "701",
        "南區": "702",
        "北區": "704",
        "安平區": "708",
        "安南區": "709",
        "永康區": "710",
        "歸仁區": "711",
        "新化區": "712",
        "左鎮區": "713",
        "玉井區": "714",
        "楠西區": "715",
        "南化區": "716",
        "仁德區": "717",
        "關廟區": "718",
        "龍崎區": "719",
        "官田區": "720",
        "麻豆區": "721",
        "佳里區": "722",
        "西港區": "723",
        "七股區": "724",
        "將軍區": "725",
        "學甲區": "726",
        "北門區": "727",
        "新營區": "730",
        "後壁區": "731",
        "白河區": "732",
        "東山區": "733",
        "六甲區": "734",
        "下營區": "735",
        "柳營區": "736",
        "鹽水區": "737",
        "善化區": "741",
        "大內區": "742",
        "山上區": "743",
        "新市區": "744",
        "安定區": "745"
      },
      "高雄市": {
        "citycode": "17",
        "新興區": "800",
        "前金區": "801",
        "苓雅區": "802",
        "鹽埕區": "803",
        "鼓山區": "804",
        "旗津區": "805",
        "前鎮區": "806",
        "三民區": "807",
        "楠梓區": "811",
        "小港區": "812",
        "左營區": "813",
        "仁武區": "814",
        "大社區": "815",
        "岡山區": "820",
        "路竹區": "821",
        "阿蓮區": "822",
        "田寮區": "823",
        "燕巢區": "824",
        "橋頭區": "825",
        "梓官區": "826",
        "彌陀區": "827",
        "永安區": "828",
        "湖內區": "829",
        "鳳山區": "830",
        "大寮區": "831",
        "林園區": "832",
        "鳥松區": "833",
        "大樹區": "840",
        "旗山區": "842",
        "美濃區": "843",
        "六龜區": "844",
        "內門區": "845",
        "杉林區": "846",
        "甲仙區": "847",
        "桃源區": "848",
        "那瑪夏區": "849",
        "茂林區": "851",
        "茄萣區": "852"
      },
      "屏東縣": {
        "citycode": "19",
        "屏東市": "900",
        "三地門鄉": "901",
        "霧臺鄉": "902",
        "瑪家鄉": "903",
        "九如鄉": "904",
        "里港鄉": "905",
        "高樹鄉": "906",
        "鹽埔鄉": "907",
        "長治鄉": "908",
        "麟洛鄉": "909",
        "竹田鄉": "911",
        "內埔鄉": "912",
        "萬丹鄉": "913",
        "潮州鎮": "920",
        "泰武鄉": "921",
        "來義鄉": "922",
        "萬巒鄉": "923",
        "崁頂鄉": "924",
        "新埤鄉": "925",
        "南州鄉": "926",
        "林邊鄉": "927",
        "東港鎮": "928",
        "琉球鄉": "929",
        "佳冬鄉": "931",
        "新園鄉": "932",
        "枋寮鄉": "940",
        "枋山鄉": "941",
        "春日鄉": "942",
        "獅子鄉": "943",
        "車城鄉": "944",
        "牡丹鄉": "945",
        "恆春鎮": "946",
        "滿州鄉": "947"
      },
      "臺東縣": {
        "citycode": "22",
        "臺東市": "950",
        "綠島鄉": "951",
        "蘭嶼鄉": "952",
        "延平鄉": "953",
        "卑南鄉": "954",
        "鹿野鄉": "955",
        "關山鎮": "956",
        "海端鄉": "957",
        "池上鄉": "958",
        "東河鄉": "959",
        "成功鎮": "961",
        "長濱鄉": "962",
        "太麻里鄉": "963",
        "金峰鄉": "964",
        "大武鄉": "965",
        "達仁鄉": "966"
      },
      "花蓮縣": {
        "citycode": "23",
        "花蓮市": "970",
        "新城鄉": "971",
        "秀林鄉": "972",
        "吉安鄉": "973",
        "壽豐鄉": "974",
        "鳳林鎮": "975",
        "光復鄉": "976",
        "豐濱鄉": "977",
        "瑞穗鄉": "978",
        "萬榮鄉": "979",
        "玉里鎮": "981",
        "卓溪鄉": "982",
        "富里鄉": "983"
      },
      "澎湖縣": {
        "citycode": "24",
        "馬公市": "880",
        "西嶼鄉": "881",
        "望安鄉": "882",
        "七美鄉": "883",
        "白沙鄉": "884",
        "湖西鄉": "885"
      },
      "金門縣": {
        "citycode": "25",
        "金沙鎮": "890",
        "金湖鎮": "891",
        "金寧鄉": "892",
        "金城鎮": "893",
        "烈嶼鄉": "894",
        "烏坵鄉": "896"
      },
      "連江縣": {
        "citycode": "26",
        "南竿鄉": "209",
        "北竿鄉": "210",
        "莒光鄉": "211",
        "東引鄉": "212"
      },
      "南海諸島": {
        "citycode": "27",
        "東沙": "817",
        "南沙": "819"
      }
    }
    var cityData = [];
    for (var key of Object.keys(cityEncodings)) {
      var val = cityEncodings[key]
      cityData.push({
        type: 'city',
        name: 'city-' + val.citycode,
        display: key,
        value: val.citycode
      });
    }

    var districtLocation = {
      "100": { lat: 25.0293387, lng: 121.5030736 },
      "103": { lat: 25.0645406, lng: 121.4958052 },
      "104": { lat: 25.0575373, lng: 121.5137806 },
      "105": { lat: 25.0602105, lng: 121.5417977 },
      "106": { lat: 25.0263453, lng: 121.5263363 },
      "108": { lat: 25.0295314, lng: 121.4803742 },
      "110": { lat: 25.0287521, lng: 121.5548065 },
      "111": { lat: 25.1349191, lng: 121.4624046 },
      "112": { lat: 25.1532874, lng: 121.4473879 },
      "114": { lat: 25.0835753, lng: 121.5553558 },
      "115": { lat: 25.0384656, lng: 121.5869683 },
      "116": { lat: 24.9880809, lng: 121.5402519 },
      "207": { lat: 25.1765329, lng: 121.6139486 },
      "208": { lat: 25.2191814, lng: 121.5370764 },
      "220": { lat: 25.0060127, lng: 121.421565 },
      "221": { lat: 25.0838931, lng: 121.592745 },
      "222": { lat: 24.9975206, lng: 121.5856747 },
      "223": { lat: 24.949817, lng: 121.5765328 },
      "224": { lat: 25.0892907, lng: 121.7675144 },
      "226": { lat: 25.0258286, lng: 121.6889127 },
      "227": { lat: 24.9986567, lng: 121.7604018 },
      "228": { lat: 25.0413778, lng: 121.8637237 },
      "231": { lat: 24.9285249, lng: 121.4639294 },
      "232": { lat: 24.9122826, lng: 121.6493537 },
      "233": { lat: 24.7837162, lng: 121.4253168 },
      "234": { lat: 25.007633, lng: 121.496547 },
      "235": { lat: 24.9903618, lng: 121.4629826 },
      "236": { lat: 24.9660538, lng: 121.4096764 },
      "237": { lat: 24.8712402, lng: 121.337344 },
      "238": { lat: 24.9814892, lng: 121.3616825 },
      "239": { lat: 24.9552528, lng: 121.314014 },
      "241": { lat: 25.0666961, lng: 121.4510543 },
      "242": { lat: 25.0322879, lng: 121.3946663 },
      "243": { lat: 25.0528074, lng: 121.3776864 },
      "244": { lat: 25.0998813, lng: 121.3138343 },
      "247": { lat: 25.0879616, lng: 121.4553728 },
      "248": { lat: 25.0965922, lng: 121.4004726 },
      "249": { lat: 25.1267576, lng: 121.379162 },
      "251": { lat: 25.1838168, lng: 121.3937295 },
      "252": { lat: 25.2310195, lng: 121.4366406 },
      "253": { lat: 25.2581533, lng: 121.5286948 },
      "200": { lat: 25.12506, lng: 121.73682},
      "201": { lat: 25.1295, lng: 121.75259},
      "202": { lat: 25.15181, lng: 121.76779},
      "203": { lat: 25.15281, lng: 121.7298},
      "204": { lat: 25.12086, lng: 121.72338},
      "205": { lat: 25.10019, lng: 121.73615},
      "206": { lat: 25.09579, lng: 121.71316},
      "260": { lat: 24.7518, lng: 121.75315},
      "261": { lat: 24.85932, lng: 121.82328},
      "262": { lat: 24.82343, lng: 121.77163},
      "263": { lat: 24.74635, lng: 121.78579},
      "264": { lat: 24.74325, lng: 121.72357},
      "265": { lat: 24.67717, lng: 121.76741},
      "266": { lat: 24.66565, lng: 121.65423},
      "267": { lat: 24.67773, lng: 121.6091},
      "268": { lat: 24.68491, lng: 121.79812},
      "269": { lat: 24.63435, lng: 121.79217},
      "270": { lat: 24.5948, lng: 121.84227},
      "272": { lat: 24.46588, lng: 121.8039},
      "290": { lat: 25.83333, lng: 123.58333},
      "300": { lat: 24.80544, lng: 120.97333},
      "300": { lat: 24.81662, lng: 120.97054},
      "300": { lat: 24.79686, lng: 120.94196},
      "302": { lat: 24.83953, lng: 121.0035},
      "303": { lat: 24.90087, lng: 121.04782},
      "304": { lat: 24.90187, lng: 120.98492},
      "305": { lat: 24.8278, lng: 121.07117},
      "306": { lat: 24.79244, lng: 121.17603},
      "307": { lat: 24.7733, lng: 121.08214},
      "308": { lat: 24.7657, lng: 120.99115},
      "310": { lat: 24.7368, lng: 121.09183},
      "311": { lat: 24.61744, lng: 121.09318},
      "312": { lat: 24.71732, lng: 121.14081},
      "313": { lat: 24.70518, lng: 121.20113},
      "314": { lat: 24.70183, lng: 121.05634},
      "315": { lat: 24.82669, lng: 121.01281},
      "315": { lat: 24.68865, lng: 121.01959},
      "320": { lat: 24.96586, lng: 121.22488},
      "324": { lat: 24.94549, lng: 121.2186},
      "325": { lat: 24.86379, lng: 121.21635},
      "326": { lat: 24.90748, lng: 121.14564},
      "327": { lat: 24.97278, lng: 121.10535},
      "328": { lat: 25.02856, lng: 121.08336},
      "330": { lat: 24.99367, lng: 121.30198},
      "333": { lat: 24.99298, lng: 121.3371},
      "334": { lat: 24.9286, lng: 121.28451},
      "335": { lat: 24.88119, lng: 121.28621},
      "336": { lat: 24.81479, lng: 121.35105},
      "337": { lat: 25.06352, lng: 121.19527},
      "338": { lat: 25.04675, lng: 121.29456},
      "350": { lat: 24.6837, lng: 120.87445},
      "351": { lat: 24.68673, lng: 120.913},
      "351": { lat: 24.56353, lng: 120.82055},
      "352": { lat: 24.65327, lng: 120.95751},
      "353": { lat: 24.59747, lng: 120.99991},
      "354": { lat: 24.5397, lng: 120.92048},
      "356": { lat: 24.59528, lng: 120.75148},
      "357": { lat: 24.49127, lng: 120.68473},
      "358": { lat: 24.4396, lng: 120.65354},
      "360": { lat: 24.56155, lng: 120.81934},
      "361": { lat: 24.63827, lng: 120.86457},
      "362": { lat: 24.57759, lng: 120.8511},
      "363": { lat: 24.50647, lng: 120.82686},
      "364": { lat: 24.42296, lng: 120.86579},
      "365": { lat: 24.44704, lng: 120.90737},
      "366": { lat: 24.48664, lng: 120.78785},
      "367": { lat: 24.41278, lng: 120.77036},
      "368": { lat: 24.55707, lng: 120.75714},
      "369": { lat: 24.31298, lng: 120.82475},
      "400": { lat: 24.1469, lng: 120.6839},
      "401": { lat: 24.1469, lng: 120.6839},
      "402": { lat: 24.1469, lng: 120.6839},
      "403": { lat: 24.1469, lng: 120.6839},
      "404": { lat: 24.1469, lng: 120.6839},
      "406": { lat: 24.1469, lng: 120.6839},
      "407": { lat: 24.1469, lng: 120.6839},
      "408": { lat: 24.1469, lng: 120.6839},
      "411": { lat: 24.1469, lng: 120.6839},
      "412": { lat: 24.1469, lng: 120.6839},
      "413": { lat: 24.1469, lng: 120.6839},
      "414": { lat: 24.10447, lng: 120.62379},
      "420": { lat: 24.24223, lng: 120.71849},
      "421": { lat: 24.3049, lng: 120.71055},
      "422": { lat: 24.1469, lng: 120.6839},
      "423": { lat: 24.1469, lng: 120.6839},
      "424": { lat: 24.1469, lng: 120.6839},
      "426": { lat: 24.1469, lng: 120.6839},
      "427": { lat: 24.2096, lng: 120.70527},
      "428": { lat: 24.1469, lng: 120.6839},
      "429": { lat: 24.1469, lng: 120.6839},
      "432": { lat: 24.1469, lng: 120.6839},
      "433": { lat: 24.2341, lng: 120.56584},
      "434": { lat: 24.1469, lng: 120.6839},
      "435": { lat: 24.25512, lng: 120.53157},
      "436": { lat: 24.1469, lng: 120.6839},
      "437": { lat: 24.1469, lng: 120.6839},
      "438": { lat: 24.1469, lng: 120.6839},
      "439": { lat: 24.1469, lng: 120.6839},
      "500": { lat: 24.08067, lng: 120.54223},
      "502": { lat: 24.01353, lng: 120.62926},
      "503": { lat: 24.01667, lng: 120.56278},
      "504": { lat: 24.03514, lng: 120.5029},
      "505": { lat: 24.05679, lng: 120.43534},
      "506": { lat: 24.04816, lng: 120.44399},
      "507": { lat: 24.13078, lng: 120.47094},
      "508": { lat: 24.1081, lng: 120.49454},
      "509": { lat: 24.15943, lng: 120.48627},
      "510": { lat: 23.95886, lng: 120.57461},
      "510": { lat: 24.07602, lng: 120.54411},
      "511": { lat: 23.89746, lng: 120.58743},
      "512": { lat: 23.92479, lng: 120.5485},
      "513": { lat: 23.95283, lng: 120.54365},
      "514": { lat: 23.96683, lng: 120.48319},
      "515": { lat: 23.99328, lng: 120.54704},
      "516": { lat: 24.00013, lng: 120.4633},
      "520": { lat: 23.86125, lng: 120.58085},
      "521": { lat: 23.87115, lng: 120.52127},
      "522": { lat: 23.89215, lng: 120.52609},
      "523": { lat: 23.89126, lng: 120.46225},
      "524": { lat: 23.85123, lng: 120.49834},
      "525": { lat: 23.86046, lng: 120.42795},
      "526": { lat: 23.89576, lng: 120.36618},
      "527": { lat: 23.8523, lng: 120.32072},
      "528": { lat: 23.92401, lng: 120.32027},
      "530": { lat: 23.80662, lng: 120.61861},
      "540": { lat: 23.9117, lng: 120.68733},
      "541": { lat: 23.87885, lng: 120.76637},
      "542": { lat: 23.97397, lng: 120.68022},
      "544": { lat: 24.04019, lng: 120.85736},
      "545": { lat: 23.96722, lng: 120.96961},
      "546": { lat: 24.02168, lng: 121.13224},
      "551": { lat: 23.83847, lng: 120.70251},
      "552": { lat: 23.82873, lng: 120.78665},
      "553": { lat: 23.81127, lng: 120.85571},
      "555": { lat: 23.89593, lng: 120.9358},
      "556": { lat: 23.69689, lng: 120.85418},
      "557": { lat: 23.75745, lng: 120.67181},
      "558": { lat: 23.74556, lng: 120.75374},
      "630": { lat: 23.67989, lng: 120.47847},
      "631": { lat: 23.64571, lng: 120.43151},
      "632": { lat: 23.7087, lng: 120.44477},
      "633": { lat: 23.68214, lng: 120.39012},
      "634": { lat: 23.69142, lng: 120.3038},
      "635": { lat: 23.67529, lng: 120.25265},
      "636": { lat: 23.69963, lng: 120.52627},
      "636": { lat: 23.70056, lng: 120.19615},
      "637": { lat: 23.76141, lng: 120.35929},
      "638": { lat: 23.75379, lng: 120.25216},
      "640": { lat: 23.69699, lng: 120.52783},
      "643": { lat: 23.75606, lng: 120.6134},
      "646": { lat: 23.64292, lng: 120.56189},
      "647": { lat: 23.76088, lng: 120.50272},
      "648": { lat: 23.79769, lng: 120.46623},
      "649": { lat: 23.77143, lng: 120.41304},
      "651": { lat: 23.57651, lng: 120.30306},
      "652": { lat: 23.57241, lng: 120.24599},
      "653": { lat: 23.58217, lng: 120.18527},
      "654": { lat: 23.6376, lng: 120.2245},
      "655": { lat: 23.64962, lng: 120.31381},
      "600": { lat: 23.47884, lng: 120.4533},
      "600": { lat: 23.4645, lng: 120.4352},
      "602": { lat: 23.46691, lng: 120.54754},
      "603": { lat: 23.58496, lng: 120.55551},
      "604": { lat: 23.52338, lng: 120.55114},
      "605": { lat: 23.51612, lng: 120.81102},
      "605": { lat: 23.46705, lng: 120.71817},
      "606": { lat: 23.42486, lng: 120.52292},
      "607": { lat: 23.29424, lng: 120.5939},
      "608": { lat: 23.42837, lng: 120.39763},
      "611": { lat: 23.4118, lng: 120.30811},
      "612": { lat: 23.45909, lng: 120.33282},
      "613": { lat: 23.46535, lng: 120.24652},
      "614": { lat: 23.45843, lng: 120.15395},
      "615": { lat: 23.49378, lng: 120.29088},
      "616": { lat: 23.55234, lng: 120.34735},
      "621": { lat: 23.55174, lng: 120.42908},
      "622": { lat: 23.60375, lng: 120.47168},
      "623": { lat: 23.60209, lng: 120.39241},
      "624": { lat: 23.33605, lng: 120.24381},
      "625": { lat: 23.37882, lng: 120.1669},
      "700": { lat: 22.99083, lng: 120.21333},
      "701": { lat: 22.99083, lng: 120.21333},
      "702": { lat: 22.99083, lng: 120.21333},
      "704": { lat: 22.99083, lng: 120.21333},
      "708": { lat: 22.99083, lng: 120.21333},
      "709": { lat: 22.99083, lng: 120.21333},
      "710": { lat: 22.99083, lng: 120.21333},
      "711": { lat: 22.99083, lng: 120.21333},
      "712": { lat: 22.99083, lng: 120.21333},
      "713": { lat: 22.99083, lng: 120.21333},
      "714": { lat: 22.99083, lng: 120.21333},
      "715": { lat: 22.99083, lng: 120.21333},
      "716": { lat: 22.99083, lng: 120.21333},
      "717": { lat: 22.99083, lng: 120.21333},
      "718": { lat: 22.99083, lng: 120.21333},
      "719": { lat: 22.99083, lng: 120.21333},
      "720": { lat: 22.99083, lng: 120.21333},
      "721": { lat: 22.99083, lng: 120.21333},
      "722": { lat: 22.99083, lng: 120.21333},
      "723": { lat: 22.99083, lng: 120.21333},
      "724": { lat: 22.99083, lng: 120.21333},
      "725": { lat: 22.99083, lng: 120.21333},
      "726": { lat: 22.99083, lng: 120.21333},
      "727": { lat: 22.99083, lng: 120.21333},
      "730": { lat: 22.99083, lng: 120.21333},
      "731": { lat: 22.99083, lng: 120.21333},
      "732": { lat: 22.99083, lng: 120.21333},
      "733": { lat: 22.99083, lng: 120.21333},
      "734": { lat: 22.99083, lng: 120.21333},
      "735": { lat: 22.99083, lng: 120.21333},
      "736": { lat: 22.99083, lng: 120.21333},
      "737": { lat: 22.99083, lng: 120.21333},
      "741": { lat: 22.99083, lng: 120.21333},
      "742": { lat: 22.99083, lng: 120.21333},
      "743": { lat: 22.99083, lng: 120.21333},
      "744": { lat: 22.99083, lng: 120.21333},
      "745": { lat: 22.99083, lng: 120.21333},
      "800": { lat: 22.6309, lng: 120.30986},
      "801": { lat: 22.62754, lng: 120.29446},
      "802": { lat: 22.62198, lng: 120.31239},
      "803": { lat: 22.62475, lng: 120.28642},
      "804": { lat: 22.63675, lng: 120.28089},
      "805": { lat: 22.61112, lng: 120.26757},
      "806": { lat: 22.58706, lng: 120.31902},
      "807": { lat: 22.6477, lng: 120.3},
      "811": { lat: 22.72832, lng: 120.32603},
      "812": { lat: 22.5651, lng: 120.33847},
      "813": { lat: 22.68957, lng: 120.29537},
      "814": { lat: 22.70144, lng: 120.34773},
      "815": { lat: 22.73026, lng: 120.34673},
      "820": { lat: 22.79734, lng: 120.29544},
      "821": { lat: 22.85436, lng: 120.2591},
      "822": { lat: 22.88287, lng: 120.32726},
      "823": { lat: 22.84051, lng: 120.40671},
      "823": { lat: 22.86915, lng: 120.35984},
      "824": { lat: 22.78849, lng: 120.36177},
      "825": { lat: 22.75767, lng: 120.30515},
      "826": { lat: 22.76067, lng: 120.26701},
      "827": { lat: 22.78159, lng: 120.25124},
      "828": { lat: 22.81821, lng: 120.22443},
      "829": { lat: 22.90854, lng: 120.21188},
      "830": { lat: 22.6363, lng: 120.35699},
      "831": { lat: 22.60615, lng: 120.39531},
      "832": { lat: 22.50788, lng: 120.39482},
      "833": { lat: 22.66002, lng: 120.36409},
      "840": { lat: 22.69305, lng: 120.43294},
      "842": { lat: 22.88901, lng: 120.48329},
      "843": { lat: 22.8949, lng: 120.54252},
      "844": { lat: 22.99811, lng: 120.6334},
      "845": { lat: 22.94279, lng: 120.46269},
      "846": { lat: 22.97236, lng: 120.54022},
      "847": { lat: 23.08372, lng: 120.58764},
      "848": { lat: 23.15903, lng: 120.76419},
      "849": { lat: 23.21763, lng: 120.69304},
      "851": { lat: 22.88596, lng: 120.66346},
      "852": { lat: 22.90698, lng: 120.18208},
      "900": { lat: 22.66209, lng: 120.49142},
      "901": { lat: 22.46066149293556, lng: 120.52380866899524},
      "901": { lat: 22.71599, lng: 120.65495},
      "902": { lat: 22.68344, lng: 120.48579},
      "902": { lat: 22.74897, lng: 120.7276},
      "903": { lat: 22.70902, lng: 120.64968},
      "904": { lat: 22.74017, lng: 120.49004},
      "905": { lat: 22.77924, lng: 120.49434},
      "906": { lat: 22.82647, lng: 120.60054},
      "907": { lat: 22.75455, lng: 120.57226},
      "908": { lat: 22.67687, lng: 120.52762},
      "909": { lat: 22.65031, lng: 120.52721},
      "911": { lat: 22.58484, lng: 120.54423},
      "912": { lat: 22.61209, lng: 120.56656},
      "913": { lat: 22.59039, lng: 120.48367},
      "920": { lat: 22.54968, lng: 120.54288},
      "921": { lat: 22.59168, lng: 120.63239},
      "922": { lat: 22.5257, lng: 120.63372},
      "923": { lat: 22.57278, lng: 120.56766},
      "924": { lat: 22.51486, lng: 120.51376},
      "925": { lat: 22.47013, lng: 120.55012},
      "926": { lat: 22.49043, lng: 120.51009},
      "927": { lat: 22.43517, lng: 120.51437},
      "928": { lat: 22.46517, lng: 120.45398},
      "929": { lat: 22.34839, lng: 120.38302},
      "931": { lat: 22.41915, lng: 120.55258},
      "932": { lat: 22.54386, lng: 120.46134},
      "940": { lat: 22.36547, lng: 120.59328},
      "941": { lat: 22.26483, lng: 120.65258},
      "942": { lat: 22.37189, lng: 120.6299},
      "943": { lat: 22.20235, lng: 120.70346},
      "944": { lat: 22.07381, lng: 120.71409},
      "945": { lat: 22.12633, lng: 120.77458},
      "946": { lat: 22.00382, lng: 120.74656},
      "947": { lat: 22.02072, lng: 120.83881},
      "950": { lat: 34.169595266000044, lng: 132.15311855400012},
      "950": { lat: 22.75489, lng: 121.14642},
      "951": { lat: 22.66881, lng: 121.46841},
      "952": { lat: 22.0568, lng: 121.50991},
      "953": { lat: 22.90223, lng: 121.08589},
      "954": { lat: 22.78254, lng: 121.08719},
      "955": { lat: 22.91717, lng: 121.13814},
      "956": { lat: 23.04717, lng: 121.1633},
      "957": { lat: 23.10222, lng: 121.17676},
      "958": { lat: 23.12236, lng: 121.2154},
      "959": { lat: 22.96894, lng: 121.30318},
      "961": { lat: 23.10594, lng: 121.38065},
      "962": { lat: 23.31514, lng: 121.45212},
      "963": { lat: 22.61524, lng: 121.00752},
      "964": { lat: 22.59444, lng: 120.96085},
      "965": { lat: 22.34068, lng: 120.88994},
      "966": { lat: 22.29659, lng: 120.88341},
      "970": { lat: 23.98215, lng: 121.60654},
      "971": { lat: 24.0392, lng: 121.60389},
      "972": { lat: 24.11882, lng: 121.62501},
      "973": { lat: 23.97345, lng: 121.5632},
      "974": { lat: 23.87018, lng: 121.50874},
      "975": { lat: 23.74498, lng: 121.4514},
      "976": { lat: 23.66942, lng: 121.42377},
      "977": { lat: 23.60189, lng: 121.52092},
      "978": { lat: 23.49588, lng: 121.37626},
      "979": { lat: 23.7147, lng: 121.41094},
      "981": { lat: 23.33553, lng: 121.31507},
      "982": { lat: 23.34624, lng: 121.30365},
      "983": { lat: 23.18026, lng: 121.25036},
      "880": { lat: 23.56606, lng: 119.57832},
      "881": { lat: 23.60083, lng: 119.50699},
      "882": { lat: 23.35748, lng: 119.50042},
      "883": { lat: 23.20587, lng: 119.42511},
      "884": { lat: 23.6661, lng: 119.59846},
      "885": { lat: 23.58348, lng: 119.6524},
      "890": { lat: 24.48875, lng: 118.41296},
      "891": { lat: 24.44128, lng: 118.41705},
      "892": { lat: 24.4509, lng: 118.33513},
      "893": { lat: 24.43279, lng: 118.32043},
      "894": { lat: 24.42954, lng: 118.24509},
      "896": { lat: 24.99094, lng: 119.45888},
      "209": { lat: 26.15327, lng: 119.93825},
      "210": { lat: 26.22461, lng: 119.99781},
      "211": { lat: 25.971, lng: 119.93348},
      "212": { lat: 26.3681, lng: 120.48939},
      "817": { lat: 38.54923211100004, lng: 140.90093933700007},
      "819": { lat: 38.54923211100004, lng: 140.90093933700007},
    };

    var accidentData = [
      { type: 'accident', name: 'accident-traffic-death', display: '交通事故致死' },
      { type: 'accident', name: 'accident-traffic-accident', display: '交通事故受傷' },
    ];

    var crimeData = [
      { type: 'crime', name: 'crime-car-theft', display: '汽車竊盜', value: 'C' },
      { type: 'crime', name: 'crime-scooter-theft', display: '機車竊盜', value: 'M' },
      { type: 'crime', name: 'crime-house-theft', display: '住宅竊盜', value: 'H' },
      { type: 'crime', name: 'crime-impulsive-raped', display: '強制性交', value: 'Ra' },
      { type: 'crime', name: 'crime-robbery', display: '強盜', value: 'Mu' },
      { type: 'crime', name: 'crime-juvenile-robbery', display: '青少年竊盜', value: 'Y' },
      { type: 'crime', name: 'crime-drugs', display: '毒品', value: 'D' },
      { type: 'crime', name: 'crime-mug', display: '搶奪', value: 'Ro' },
    ];

    function collectCrimeData() {
      var b = current_bound
      var result = {
        top: b.top,
        bottom: b.bottom,
        left: b.left,
        right: b.right,
        city: [],
        dist: [],
        crime: []
      };
      var checked = $('#filter-app input[type="checkbox"]:checked');
      for (var element of checked) {
        if (new RegExp('-all').test(element.id)) { continue; }
        if (new RegExp('city').test(element.id)) {
          result.city.push(parseInt(element.id.replace(/city-/, '')))
        } else if (new RegExp('district').test(element.id)) {
          result.dist.push(parseInt(element.id.replace(/district-/, '')))
        } else if (new RegExp('crime').test(element.id)) {
          var crimeCode = crimeData.filter(function(crime) { return element.name == crime.name })[0].value
          result.crime.push(crimeCode);
        }
      }
      result.city = result.city.map(function(code) { return String(code) }).join(',')
      result.dist = result.dist.map(function(code) { return String(code) }).join(',')
      result.crime = result.crime.join(',')
      console.log('Collect crime data: ', result);
      return result;
    }

    function collectAccidentData() {
      var b = current_bound
      var result = {
        top: b.top,
        bottom: b.bottom,
        left: b.left,
        right: b.right,
        city: [],
        dist: [],
        death: false,
        injury: false
      };
      var checked = $('#filter-app input[type="checkbox"]:checked');
      for (var element of checked) {
        if (new RegExp('-all').test(element.id)) { continue; }
        if (new RegExp('city').test(element.id)) {
          result.city.push(parseInt(element.id.replace(/city-/, '')))
        } else if (new RegExp('district').test(element.id)) {
          result.dist.push(parseInt(element.id.replace(/district-/, '')))
        } else if (new RegExp('accident').test(element.id)) {
          if (element.name == 'accident-traffic-death') {
            result.death = true
          } else if (element.name == 'accident-traffic-accident') {
            result.injury = true
          } else if (element.id == 'accident-mode') {
            result.kpi = true
          }
        }
      }
      result.city = result.city.map(function(code) { return String(code) }).join(',')
      result.dist = result.dist.map(function(code) { return String(code) }).join(',')
      console.log('Collect accident data: ', result);
      return result;
    }

    //var baseURL = 'http://192.168.43.158:8000';
    var baseURL = 'https://crimex.silvester.space/api';

    function sendSearchCrimeRequest(callback) {
      $.ajax({
        url: baseURL + '/v1/crimex/crime',
        type: 'get',
        data: collectCrimeData(),
        dataType: 'json',
        success: function(data) { callback(data); },
        error: function() {
          console.error('Something wrong with the sendSearchCrimeRequest!');
        }
      })
    }

    function sendSearchAccidentRequest(callback) {
      $.ajax({
        url: baseURL + '/v1/crimex/accident',
        data: {
          bound: current_bound,
          params: collectAccidentData()
        },
        dataType: 'json',
        success: function(data) { callback(data); },
        error: function() {
          console.error('Something wrong with the sendSearchAccidentRequest!');
        }
      })
    }

    var Filter = React.createClass({
      getInitialState: function() {
        return { districtData: [] };
      },
      componentDidMount: function() {
        $('#filter-app').on('change', 'input', function(event) {
          sendSearchCrimeRequest(function(data) {
            console.log("Data search from Crime request: ", data);
            if ($markers) { clearMarkers(); $markers = [] }
            var crimemapData = data.results.map(function(d) {
              for (var city of Object.keys(cityEncodings)) {
                var cityData = cityEncodings[city];
                if (cityData.citycode == d[0]) {
                  for (var district of Object.keys(cityData)) {
                    var districtCode = cityData[district];
                    if (districtCode == d[1]) {
                      for (var c of crimeData) {
                        if (c.value == d[2]) {
                          return {
                            city: city,
                            district: district,
                            districtCode: districtCode,
                            crime: c.display,
                          }
                        }
                      }
                    }
                  }
                }
              }
            });
            for (var data of crimemapData) {
              if (!data || !data.districtCode) { continue; }
              var position =  districtLocation[data.districtCode];
              if (!position) { continue; }
              position.lat = position.lat + (Math.random() / 50 - 0.01)
              position.lng = position.lng + (Math.random() / 50 - 0.01)
              var marker = new google.maps.Marker({
                position: position,
                map: map,
                title: data.city + data.district,
                icon: { url: './public/logo/' + data.crime + '.svg', scaledSize: new google.maps.Size(35, 35) }
              });
              $markers.push(marker);
              (function(pos, marker) {
                var infowindow = new google.maps.InfoWindow({
                  content: "經度：" + pos.lat + " <br/> 緯度：" + pos.lng + '<br/> 區域：' + data.city + data.district + '<br/> 類型：' + data.crime,
                });
                google.maps.event.addListener(marker, 'mouseover', function() {
                  infowindow.open(map, marker);
                });
                google.maps.event.addListener(marker, 'mouseout', function() {
                  infowindow.close();
                });
              })(position, marker);
            }
          });
          sendSearchAccidentRequest(function(data) {
            console.log("Data search from Accident request: ", data);
            if ($heatmap) { $heatmap.setMap(null) }
            var heatmapData = data.results.map(function(d) {
              return new google.maps.LatLng(d[0], d[1])
            });
            
            $heatmap = new google.maps.visualization.HeatmapLayer({
              data: heatmapData
            });
            $heatmap.setMap(map);
          });
        });
      },
      handleSetDistrictData: function(citycode) {
        for (var key of Object.keys(cityEncodings)) {
          var val = cityEncodings[key];
          if (val.citycode == citycode) {
            var districtData = []
            for (var districtName of Object.keys(val)) {
              if (districtName == 'citycode') { continue; }
              var districtCode = val[districtName]
              districtData.push({ type: 'district', name: 'district-' + districtCode, display: districtName, value: districtCode })
            }
            this.setState({ districtData: districtData })
            var filterDistrictAllInput = this.refs['district-filter'].refs['filter-all'].refs.label
            $(filterDistrictAllInput).removeClass('disabled')
            $('#district-filter-group input[type="checkbox"]').prop('checked', true);
          }
        }
      },
      handleClearDistrictData: function() {
        this.setState({ districtData: [] })
        var filterDistrictAllInput = this.refs['district-filter'].refs['filter-all'].refs.label
        $(filterDistrictAllInput).addClass('disabled')
        var filterDistrictAllCheckbox = this.refs['district-filter'].refs['filter-all'].refs.input
        $(filterDistrictAllCheckbox).prop('checked', false)
      },
      render: function() {
        return (
          <div className="filter">
            <h3>縣市 City</h3>
            <CheckboxGroup
              id="city-filter-group"
              all="city-all"
              options={cityData}
              setDistrictData={this.handleSetDistrictData}
              clearDistrictData={this.handleClearDistrictData}
            ></CheckboxGroup>

            <h3>區域 District</h3>
            <CheckboxGroup
              ref="district-filter"
              id="district-filter-group"
              all="district-all"
              options={this.state.districtData}
            ></CheckboxGroup>

            <h3>
              事故類別 Accident
              <AccidentSwitch on="severity" off="frequency" />
            </h3>
            <CheckboxGroup
              id="accident-filter-group"
              all="accident-all"
              options={accidentData}
            ></CheckboxGroup>

            <h3>犯罪類別 Crime</h3>
            <CheckboxGroup
              id="crime-filter-group"
              all="crime-all"
              options={crimeData}
            ></CheckboxGroup>
          </div>
        )
      }
    });

    var CheckboxGroup = React.createClass({
      componentDidMount: function() {
        switch(this.props.id) {
          case 'city-filter-group':
            $('#city-filter-group input[type="checkbox"]').each(function() {
              $(this).prop('checked', false);
            });

            $('#city-filter-group').on('click', 'label', function(event) {
              if ($('input#' + $(this).attr('for')).is(':checked')) return;
              var pos = cityLocation[$(this).text()]
              if (pos) { map.setCenter(pos); }
            });

            $('#city-filter-group').on('change', 'input[type="checkbox"]', function(event) {
              var checked = $('#city-filter-group input[type="checkbox"]:checked')
              var checkedCount = checked.length
              if (checkedCount == 1) {
                this.props.setDistrictData(checked[0].id.replace(/^\D+/, ''))
              } else {
                this.props.clearDistrictData();
              }
            }.bind(this));
            break;

          case 'accident-filter-group':
            $('#accident-filter-group input[type="checkbox"]').each(function() {
              $(this).prop('checked', true);
            });
            break;

          case 'crime-filter-group':
            $('#crime-filter-group input[type="checkbox"]').each(function() {
              $(this).prop('checked', true);
            });
            break;
        }
      },
      handleUnifyCheckboxState: function(state) {
        $('#' + this.props.id + ' input[type="checkbox"]').prop('checked', state);
      },
      handleDisableSelectAll: function(type) {
        $('input#' + type + '-all').prop('checked', false);
      },
      render: function() {
        var renderOtherOptions = null
        if (this.props.options) {
          renderOtherOptions = this.props.options.map(function(obj) {
            return (
              <Checkbox
                type={obj.type}
                name={obj.name}
                disableSelectAll={this.handleDisableSelectAll}
              >{obj.display}</Checkbox>
            )
          }.bind(this));
        }
        return (
          <div id={this.props.id} className="checkboxGroup">
            <Checkbox ref="filter-all" type={this.props.type} name={this.props.all} value={this.props.value} unifyCheckboxState={this.handleUnifyCheckboxState}>全部</Checkbox>
            {renderOtherOptions}
          </div>
        )
      }
    });

    var Checkbox = React.createClass({
      componentDidMount: function() {
        if (this.props.name == 'district-all') {
          $(this.refs.label).addClass('disabled')
        }

        if (new RegExp('-all').test(this.props.name)) {
          $(this.refs.input).on('change', function(event) {
            this.props.unifyCheckboxState($(this.refs.input).is(':checked'));
          }.bind(this));
        } else {
          $(this.refs.input).on('change', function(event) {
            if (!$(this.refs.input).is(':checked')) {
              this.props.disableSelectAll(this.props.type)
            }
          }.bind(this));
        }

        $(this.refs.input).data('value', this.props.value);
      },
      render: function() {
        return (
          <div className="checkbox">
            <input ref="input" className="filter-checkbox" type="checkbox" name={this.props.name} id={this.props.name} />
            <label ref="label" className="filter-label" htmlFor={this.props.name}>{this.props.children}</label>
          </div>
        )
      }
    });

    var AccidentSwitch = React.createClass({
      render: function() {
        return (
          <div className="accident-switch">
            <input ref="input" type="checkbox" name="accident-mode" id="accident-mode" />
            <label ref="label" htmlFor="accident-mode"></label>
          </div>
        )
      }
    })

    ReactDOM.render(
      <Filter />,
      document.getElementById('filter-app')
    )
  </script>
</body>
</html>
